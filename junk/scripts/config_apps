#!/bin/bash

# Script to configure applications (VSCode and Firefox) for a user
# This script centralizes application configuration logic

set -e  # Exit on any error

# Default values
USERNAME=""
VSCODE_PORT="8080"
DISPLAY=":0"
VSCODE_HOST="0.0.0.0"

# Function to show usage
show_usage() {
    echo "Usage: $0 [OPTIONS]"
    echo ""
    echo "Required Options:"
    echo "  --username USERNAME    Set the username (required)"
    echo ""
    echo "Optional Options:"
    echo "  --port PORT           Set VS Code port (default: 8080)"
    echo "  --host HOST           Set VS Code host (default: 0.0.0.0)"
    echo "  --display DISPLAY     Set display (default: :0)"
    echo "  --help                Show this help message"
    echo ""
    echo "Examples:"
    echo "  $0 --username testuser"
    echo "  $0 --username developer --port 9000"
    echo "  $0 --username admin  --display :1"
}

# Parse command line arguments
while [[ $# -gt 0 ]]; do
    case $1 in
        --username)
            USERNAME="$2"
            shift 2
            ;;
        --port)
            VSCODE_PORT="$2"
            shift 2
            ;;
        --host)
            VSCODE_HOST="$2"
            shift 2
            ;;
        --display)
            DISPLAY="$2"
            shift 2
            ;;
        --help|-h)
            show_usage
            exit 0
            ;;
        *)
            echo "Unknown option: $1"
            echo ""
            show_usage
            exit 1
            ;;
    esac
done

# Validate required parameters
if [ -z "$USERNAME" ]; then
    echo "Error: Username is required"
    echo ""
    show_usage
    exit 1
fi

# Check if user exists
if ! id "$USERNAME" &>/dev/null; then
    echo "Error: User $USERNAME does not exist"
    exit 1
fi

echo "Configuring applications for user: $USERNAME"

/usr/local/bin/add_firefox --username "$USERNAME" --display "$DISPLAY"

/usr/local/bin/add_vscode --username "$USERNAME" --port "$VSCODE_PORT" --host "$VSCODE_HOST" --display "$DISPLAY"

